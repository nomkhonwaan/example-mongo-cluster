version: '2'
services:

  data:
    image: 'alpine:latest'
    volumes:
      - '$PWD/scripts/setup:/setup'
      - '$PWD/../.tmp/replica-cluster/mongo-rc0svr1:/mongo-rc0svr1'
      - '$PWD/../.tmp/replica-cluster/mongo-rc0svr2:/mongo-rc0svr2'
      - '$PWD/../.tmp/replica-cluster/mongo-rc0svr3:/mongo-rc0svr3'
    command: '/bin/true'

  mongo-rc0svr1:
    image: 'mongo:latest'
    volumes_from:
    - 'data'
    command: 'mongod --dbpath /mongo-rc0svr1 --replSet rc0 --smallfiles'
  mongo-rc0svr2:
    image: 'mongo:latest'
    volumes_from:
    - 'data'
    command: 'mongod --dbpath /mongo-rc0svr2 --replSet rc0 --smallfiles'
  mongo-rc0svr3:
    image: 'mongo:latest'
    volumes_from:
    - 'data'
    command: 'mongod --dbpath /mongo-rc0svr3 --replSet rc0 --smallfiles'

  setup:
    image: 'mongo:latest'
    depends_on:
      - 'mongo-rc0svr1'
      - 'mongo-rc0svr2'
      - 'mongo-rc0svr3'
    volumes_from:
      - 'data'
    entrypoint: '/setup/entrypoint.sh'
    links:
      - 'mongo-rc0svr1:mongo-rc0svr1'
      - 'mongo-rc0svr2:mongo-rc0svr2'
      - 'mongo-rc0svr3:mongo-rc0svr3'

  mongoclient:
    image: 'mongoclient/mongoclient:latest'
    ports:
      - '3000:3000'
    links:
      - 'mongo-rc0svr1:mongo-rc0svr1'
      - 'mongo-rc0svr2:mongo-rc0svr2'
      - 'mongo-rc0svr3:mongo-rc0svr3'
